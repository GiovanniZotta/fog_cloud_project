Hello, first of all I am sorry for the long message.
Maybe someone has already gone through this issue and can help us, or maybe it will help someone in the future.

I am trying to set up a multi-node cluster where I have the master node on the paas machine, while the workers are running as OpenStack instances on the iaas machine.
I am using Kubeadm and Flannel as an overlay network plugin.

Each worker node has its floating IP and therefore everyone can communicate with any other host, all the ports are open on the security group side, both for TCP and UDP.
kubectl shows an healthy cluster, where every worker node figures with its floating IP.

```
giovanni.zotta@paas-07:~$ kubectl get nodes -o wide
NAME             STATUS   ROLES                  AGE    VERSION   INTERNAL-IP    EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION       CONTAINER-RUNTIME
apollo-server1   Ready    <none>                 124m   v1.21.1   172.24.4.186   <none>        Ubuntu 18.04.5 LTS   4.15.0-142-generic   docker://20.10.2
apollo-server2   Ready    <none>                 124m   v1.21.1   172.24.4.214   <none>        Ubuntu 18.04.5 LTS   4.15.0-142-generic   docker://20.10.2
paas-07          Ready    control-plane,master   132m   v1.21.1   10.235.1.107   <none>        Ubuntu 18.04.5 LTS   4.15.0-142-generic   docker://20.10.2
```

I have a pod running whoami on worker 2

```
giovanni.zotta@paas-07:~$ kubectl get pods -o wide
NAME                     READY   STATUS    RESTARTS   AGE    IP           NODE             NOMINATED NODE   READINESS GATES
server-69f46897c-cwrm2   1/1     Running   1          113m   10.244.2.3   apollo-server2   <none>           <none>
```

Here is the problem: from the master node, I would like to get a response from the pod running whoami. However, it doesn't work.
It turns out that Master-to-Pod communication is not working, and neither does Pod-to-Pod communication IF the pods are on different worker nodes.
Side-note: from the worker node where the pod is running, I can actually get a response from it.

Here is the (cleaned out) output of tshark on both Master and Worker. (flannel uses VXLAN, which encapsulates packets inside UDP in order to reach the pod network which is 10.244.0.0/16 in this case)
As a reminder:
```
Master-ip: 10.235.1.107 - 10.244.0.0
Worker-ip: 172.24.4.214 (10.11.12.91 private) - 10.244.2.2 (pod)
```

Executing the following command on Master gives a timeout.
```
giovanni.zotta@paas-07:~$ curl http://10.244.2.2:8000 
```

--- Listening on Master ---
Frame 1
    Ethernet II, Src: fa:16:3e:76:3f:41, Dst: fa:16:3e:2b:e2:81
    IPv4, Src: 10.235.1.107, Dst: 172.24.4.214
    UDP, Src Port: 51778, Dst Port: 8472
        VXLAN
            Ethernet II, Src: 2e:62:d1:1f:70:c8, Dst: 7a:b2:af:ec:48:0b
            IPv4, Src: 10.244.0.0, Dst: 10.244.2.2
            TCP, Src Port: 58400, Dst Port: 8000, Seq: 0, Len: 0  (SYN)

--- no response, just retranmissions

--- Listening on Worker ---
Frame 1
    Ethernet II, Src: fa:16:3e:ea:36:46, Dst: fa:16:3e:91:d2:76
    IPv4, Src: 10.235.1.107, Dst: 10.11.12.91
    UDP, Src Port: 51778, Dst Port: 8472
        VXLAN
            Ethernet II, Src: 2e:62:d1:1f:70:c8, Dst: 7a:b2:af:ec:48:0b
            IPv4, Src: 10.244.0.0, Dst: 10.244.2.2
            TCP, Src Port: 58400, Dst Port: 8000, Seq: 0, Len: 0 (SYN)

Frame 2
    Ethernet II, Src: fa:16:3e:91:d2:76, Dst: fa:16:3e:ea:36:46
    IPv4, Src: 172.24.4.214, Dst: 10.235.1.107
    UDP, Src Port: 35490, Dst Port: 8472
        VXLAN
            Ethernet II, Src: 7a:b2:af:ec:48:0b, Dst: 2e:62:d1:1f:70:c8
            IPv4, Src: 10.244.2.2, Dst: 10.244.0.0
            TCP, Src Port: 8000, Dst Port: 58400, Seq: 0, Ack: 1, Len: 0  (SYN + ACK)

First of all, one weird thing that I noticed is that the first TCP SYN packet that is generated by the Master has dst IP 172.24.4.214 (floating ip of the worker node), while when it arrives on the worker it has dst IP 10.11.12.91, which is its private address).
Anyway, the encapsulated packet inside VXLAN carries the right information and indeed the pod replies back with a SYN+ACK!
But... that's it. That packet never reaches the master node (recall that the nodes have full communication capabilities, tcp, udp and icmp). Also, the generated SYN+ACK has the floating ip of the worker as source IP. (is this a problem? does the openstack router see it a spoofed ip and drop it or something?)
Another weird thing is that the source and destination of the encapsulated packets is 10.244.0.0. Shouldn't this point to a network address and not to a host?
To be completely honest, I still lack a complete understanding of flannel and of some networking details. Anyway, I feel like I should be close to the solution and that I am missing some pieces.

If anyone is willing to take a look at the problem, I would really appreciate some suggestions. I have been banging my head on a wall for the past couple of days.

If I had to take a guess, this has probably something to do with iptables and flannel/cni, but may as well be some misconfiguration in the routing tables.

As an attachment, I dump the interfaces and ip routes of the machines.

MASTER
```
giovanni.zotta@paas-07:~$ ip --brief route
default via 10.235.1.1 dev ens3 proto dhcp src 10.235.1.107 metric 100
10.96.0.0/12 dev ens3 scope link
10.235.1.0/24 dev ens3 proto kernel scope link src 10.235.1.107
10.244.1.0/24 via 10.244.1.0 dev flannel.1 onlink
10.244.2.0/24 via 10.244.2.0 dev flannel.1 onlink
169.254.169.254 via 10.235.1.1 dev ens3 proto dhcp src 10.235.1.107 metric 100
172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1 linkdown
172.18.0.0/16 dev br-766966e83fc2 proto kernel scope link src 172.18.0.1 linkdown
172.24.4.0/24 via 10.235.1.207 dev ens3

giovanni.zotta@paas-07:~$ ip --brief addr
lo               UNKNOWN        127.0.0.1/8 ::1/128
ens3             UP             10.235.1.107/24 fe80::f816:3eff:fe76:3f41/64
docker0          DOWN           172.17.0.1/16 fe80::42:9cff:fea1:4b44/64
br-766966e83fc2  DOWN           172.18.0.1/16 fc00:f853:ccd:e793::1/64 fe80::42:9cff:febd:5da3/64 fe80::1/64
flannel.1        UNKNOWN        10.244.0.0/32 fe80::2c62:d1ff:fe1f:70c8/64
cni0             UP             10.244.0.1/24 fe80::f04f:66ff:fe0b:55a6/64
vethc418052d@docker0 UP             fe80::28f5:a5ff:fea0:818d/64
veth801c0386@docker0 UP             fe80::6ccc:cfff:feae:c028/64
```

WORKER
```
ubuntu@apollo-server2:~$ ip --brief route
default via 10.11.12.1 dev ens3 proto dhcp src 10.11.12.91 metric 100
10.11.12.0/24 dev ens3 proto kernel scope link src 10.11.12.91
10.244.0.0/24 via 10.244.0.0 dev flannel.1 onlink
10.244.1.0/24 via 10.244.1.0 dev flannel.1 onlink
10.244.2.0/24 dev cni0 proto kernel scope link src 10.244.2.1
169.254.169.254 via 10.11.12.1 dev ens3 proto dhcp src 10.11.12.91 metric 100
172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1 linkdown

ubuntu@apollo-server2:~$ ip --brief addr
lo               UNKNOWN        127.0.0.1/8 ::1/128
ens3             UP             172.24.4.214/32 10.11.12.91/24 fe80::f816:3eff:fe91:d276/64
docker0          DOWN           172.17.0.1/16
flannel.1        UNKNOWN        10.244.2.0/32 fe80::78b2:afff:feec:480b/64
cni0             UP             10.244.2.1/24 fe80::444d:9bff:fe3d:897c/64
veth9176a725@docker0 UP             fe80::4491:89ff:fed7:d5c6/64
```

